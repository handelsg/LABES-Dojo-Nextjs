# ๐จ Diagrama Visual da Arquitetura

## ๐ Visรฃo Completa do Sistema

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                              ๐ NAVEGADOR                                   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                        ๐ค INTERFACE DO USUรRIO                        โ โ
โ  โ                                                                       โ โ
โ  โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ                 โ โ
โ  โ  โ   Header    โ  โ    Grid     โ  โ   Footer    โ                 โ โ
โ  โ  โ   โโโโโ     โ  โ   โโโโโ     โ  โ   โโโโโ     โ                 โ โ
โ  โ  โ  ๐๏ธ Logo   โ  โ  ๐ฆ Cards   โ  โ  ๐ Info    โ                 โ โ
โ  โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ                 โ โ
โ  โ                                                                       โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โ  โ           ๐ CLIENT COMPONENTS (use client)                     โ โ โ
โ  โ  โ                                                                 โ โ โ
โ  โ  โ  โข SearchBar.tsx         โ Busca interativa                    โ โ โ
โ  โ  โ  โข CategoryFilter.tsx    โ Filtro por categoria                โ โ โ
โ  โ  โ  โข RefreshButton.tsx     โ Botรฃo de atualizaรงรฃo                โ โ โ
โ  โ  โ                                                                 โ โ โ
โ  โ  โ  Estado: useState, useTransition, useEffect                    โ โ โ
โ  โ  โ  Eventos: onClick, onChange, onSubmit                          โ โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                               โ
                               โ ๐ก HTTP Request / Server Actions
                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐ฅ๏ธ  NEXT.JS SERVER                                   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                     ๐ SERVER COMPONENTS                              โ โ
โ  โ                                                                       โ โ
โ  โ  src/app/page.tsx                 โ Homepage (SSR)                   โ โ
โ  โ  src/app/produto/[id]/page.tsx    โ Detalhes (SSG)                   โ โ
โ  โ                                                                       โ โ
โ  โ  โข Renderizam HTML no servidor                                       โ โ
โ  โ  โข Fazem fetch de dados direto                                       โ โ
โ  โ  โข Nรฃo aumentam bundle JS do cliente                                 โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                              โ                                             โ
โ                              โ Usa                                         โ
โ                              โผ                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                     โก SERVER ACTIONS (use server)                    โ โ
โ  โ                                                                       โ โ
โ  โ  src/actions/product.actions.ts                                      โ โ
โ  โ                                                                       โ โ
โ  โ  โข getProductsAction()          โ Busca todos produtos               โ โ
โ  โ  โข getProductByIdAction()       โ Busca produto especรญfico           โ โ
โ  โ  โข searchProductsAction()       โ Busca com termo                    โ โ
โ  โ  โข getCategoriesAction()        โ Busca categorias                   โ โ
โ  โ  โข getProductsByCategoryAction() โ Filtra por categoria              โ โ
โ  โ  โข revalidateProductsAction()   โ Invalida cache                     โ โ
โ  โ                                                                       โ โ
โ  โ  Retorno: ActionResult<T> = { success, data } | { success, error }  โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                              โ                                             โ
โ                              โ Usa                                         โ
โ                              โผ                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                     ๐ข SERVICES (Lรณgica de Negรณcio)                   โ โ
โ  โ                                                                       โ โ
โ  โ  src/services/product.service.ts                                     โ โ
โ  โ                                                                       โ โ
โ  โ  ProductService.getAllProducts(filters?)                             โ โ
โ  โ       โโโบ Aplica filtros (categoria, preรงo, busca)                   โ โ
โ  โ       โโโบ Aplica ordenaรงรฃo (preรงo, rating, nome)                     โ โ
โ  โ       โโโบ Retorna Product[]                                          โ โ
โ  โ                                                                       โ โ
โ  โ  ProductService.getProductById(id)                                   โ โ
โ  โ       โโโบ Valida ID                                                  โ โ
โ  โ       โโโบ Busca produto                                              โ โ
โ  โ       โโโบ Retorna Product                                            โ โ
โ  โ                                                                       โ โ
โ  โ  ProductService.getFeaturedProducts(limit)                           โ โ
โ  โ       โโโบ Busca todos produtos                                       โ โ
โ  โ       โโโบ Ordena por rating.rate                                     โ โ
โ  โ       โโโบ Retorna top N produtos                                     โ โ
โ  โ                                                                       โ โ
โ  โ  ProductService.getCategories()                                      โ โ
โ  โ       โโโบ Retorna string[]                                           โ โ
โ  โ                                                                       โ โ
โ  โ  ProductService.getStaticParams()                                    โ โ
โ  โ       โโโบ Retorna { id: string }[] para SSG                          โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                              โ                                             โ
โ                              โ Usa                                         โ
โ                              โผ                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                     ๐ API CLIENT (HTTP Client)                       โ โ
โ  โ                                                                       โ โ
โ  โ  src/lib/api-client.ts                                               โ โ
โ  โ                                                                       โ โ
โ  โ  apiClient.get<T>(endpoint, options)                                 โ โ
โ  โ       โโโบ Adiciona headers padrรฃo                                    โ โ
โ  โ       โโโบ Configura timeout (10s)                                    โ โ
โ  โ       โโโบ Retry automรกtico (3x)                                      โ โ
โ  โ       โโโบ Backoff exponencial                                        โ โ
โ  โ       โโโบ Tratamento de erros                                        โ โ
โ  โ       โโโบ Logging (dev only)                                         โ โ
โ  โ                                                                       โ โ
โ  โ  apiClient.post<T>(endpoint, data, options)                          โ โ
โ  โ  apiClient.put<T>(endpoint, data, options)                           โ โ
โ  โ  apiClient.delete<T>(endpoint, options)                              โ โ
โ  โ                                                                       โ โ
โ  โ  Features:                                                           โ โ
โ  โ  โข AbortController para timeout                                      โ โ
โ  โ  โข Retry com delay incremental                                       โ โ
โ  โ  โข Tipos genรฉricos <T> para type-safety                             โ โ
โ  โ  โข Error handling consistente                                        โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                              โ                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                     ๐พ NEXT.JS CACHE LAYER                            โ โ
โ  โ                                                                       โ โ
โ  โ  Cache de Dados (Data Cache)                                         โ โ
โ  โ  โโโบ next: { revalidate: 60 }     โ Revalida a cada 60s             โ โ
โ  โ  โโโบ next: { tags: ['products'] }  โ Revalidaรงรฃo por tags            โ โ
โ  โ  โโโบ Cache automรกtico entre requests                                 โ โ
โ  โ                                                                       โ โ
โ  โ  Cache de Rotas (Router Cache)                                       โ โ
โ  โ  โโโบ Pรกginas jรก visitadas                                            โ โ
โ  โ  โโโบ Navegaรงรฃo instantรขnea (SPA)                                     โ โ
โ  โ                                                                       โ โ
โ  โ  Cache de Renderizaรงรฃo (Full Route Cache)                            โ โ
โ  โ  โโโบ Pรกginas estรกticas (SSG)                                         โ โ
โ  โ  โโโบ generateStaticParams()                                          โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                               โ
                               โ ๐ HTTP GET Request
                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐ API EXTERNA                                       โ
โ                   https://fakestoreapi.com                                  โ
โ                                                                             โ
โ  GET /products              โ Lista todos produtos (20 itens)               โ
โ  GET /products/:id          โ Busca produto especรญfico                      โ
โ  GET /products/categories   โ Lista categorias                              โ
โ  GET /products/category/:c  โ Produtos de uma categoria                     โ
โ                                                                             โ
โ  Retorno JSON: Product[]                                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐ฆ TIPOS (TypeScript)                                โ
โ                                                                             โ
โ  src/types/product.ts                                                       โ
โ                                                                             โ
โ  interface Product {                                                        โ
โ    id: number;                                                              โ
โ    title: string;                                                           โ
โ    price: number;                                                           โ
โ    image: string;                                                           โ
โ    category: string;                                                        โ
โ    description: string;                                                     โ
โ    rating: { rate: number; count: number };                                 โ
โ  }                                                                          โ
โ                                                                             โ
โ  interface ProductFilters {                                                 โ
โ    category?: string;                                                       โ
โ    minPrice?: number;                                                       โ
โ    maxPrice?: number;                                                       โ
โ    search?: string;                                                         โ
โ    sortBy?: "price" | "rating" | "name";                                   โ
โ    sortOrder?: "asc" | "desc";                                              โ
โ  }                                                                          โ
โ                                                                             โ
โ  type ActionResult<T> =                                                     โ
โ    | { success: true; data: T }                                             โ
โ    | { success: false; error: string };                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Fluxo de Dados Completo

### Cenรกrio 1: Usuรกrio Acessa Homepage

```
1. Navegador
   โโโบ GET / (http://localhost:3000)

2. Next.js Server
   โโโบ Identifica rota: src/app/page.tsx (Server Component)

3. Executa Home()
   โโโบ const products = await ProductService.getAllProducts()

4. ProductService.getAllProducts()
   โโโบ return apiClient.get<Product[]>("/products")

5. apiClient.get()
   โโโบ Verifica cache (60s TTL)
   โ   โโ Cache vรกlido? โ Retorna do cache โก
   โ   โโ Cache expirado? โ Continua...
   โ
   โโโบ fetch("https://fakestoreapi.com/products")
   โโโบ Retry automรกtico se falhar (3x)
   โโโบ Valida resposta (response.ok)
   โโโบ return await response.json()

6. Retorna dados
   API โ apiClient โ ProductService โ Home()

7. Home() renderiza HTML
   โโโบ <div><ProductCard />...</div>

8. Next.js envia resposta
   โโโบ HTML: ~150KB (renderizado)
   โโโบ CSS: ~50KB (Tailwind purged)
   โโโบ JS: ~200KB (React + Next.js)

9. Navegador renderiza
   โโโบ Parse HTML (20ms)
   โโโบ Aplica CSS (10ms)
   โโโบ Carrega imagens (lazy)
   โโโบ React hidrata (100ms)

10. Pรกgina interativa! ๐

โฑ๏ธ Tempo total: ~200-300ms (com cache: ~50ms)
```

---

### Cenรกrio 2: Usuรกrio Digita na Busca

```
1. SearchBar (Client Component)
   โโโบ onChange={(e) => handleSearch(e.target.value)}

2. handleSearch("shirt")
   โโโบ startTransition(async () => {
         const result = await searchProductsAction("shirt");
       })

3. searchProductsAction() [Server Action]
   โโโบ Executa NO SERVIDOR (not client!)
   โโโบ const products = await ProductService.getAllProducts({ search: "shirt" })

4. ProductService.getAllProducts({ search: "shirt" })
   โโโบ Busca todos produtos (cache ou API)
   โโโบ Aplica filtro de busca:
       products.filter(p =>
         p.title.includes("shirt") ||
         p.description.includes("shirt") ||
         p.category.includes("shirt")
       )

5. Retorna resultado
   Service โ Action โ Client
   โโโบ { success: true, data: [...] }

6. SearchBar atualiza estado
   โโโบ setResults(result.data)

7. React re-renderiza
   โโโบ Mostra produtos filtrados

โฑ๏ธ Tempo: ~100-200ms
```

---

### Cenรกrio 3: Usuรกrio Clica em Produto

```
1. ProductCard
   โโโบ <Link href="/produto/5">

2. Next.js Router (Client-side)
   โโโบ Intercepta click (SPA navigation)
   โโโบ Muda URL: / โ /produto/5

3. Verifica se pรกgina foi prรฉ-gerada (SSG)
   โโโบ SIM (generateStaticParams)
   โ   โโโบ Carrega HTML estรกtico (< 50ms) โกโกโก
   โ
   โโโบ NรO (fallback)
       โโโบ Renderiza sob demanda (SSR)

4. Se SSG (prรฉ-gerado):
   โโโบ HTML jรก existe no build
   โโโบ Apenas hidrata

5. Se SSR (sob demanda):
   โโโบ Executa ProductPage({ params: { id: "5" } })
   โโโบ await ProductService.getProductById("5")
   โโโบ apiClient.get("/products/5")
   โโโบ Renderiza HTML
   โโโบ Retorna ao cliente

6. Transiรงรฃo suave
   โโโบ Sem reload completo
   โโโบ Sem flash branco
   โโโบ Navegaรงรฃo fluida

โฑ๏ธ Tempo SSG: ~50ms โกโกโก
โฑ๏ธ Tempo SSR: ~300ms โก
```

---

## ๐ Comparaรงรฃo de Performance

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  MรTRICAS DE PERFORMANCE                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                              โ
โ  Homepage (Server Component + Cache)                         โ
โ  โโโบ TTFB (Time to First Byte): ~50ms                       โ
โ  โโโบ FCP (First Contentful Paint): ~150ms                   โ
โ  โโโบ LCP (Largest Contentful Paint): ~200ms                 โ
โ  โโโบ TTI (Time to Interactive): ~300ms                      โ
โ                                                              โ
โ  Pรกgina de Detalhes (SSG)                                    โ
โ  โโโบ TTFB: ~20ms                                            โ
โ  โโโบ FCP: ~80ms                                             โ
โ  โโโบ LCP: ~120ms                                            โ
โ  โโโบ TTI: ~200ms                                            โ
โ                                                              โ
โ  Busca (Client Component + Server Action)                   โ
โ  โโโบ Tempo de resposta: ~100-200ms                         โ
โ  โโโบ Mantรฉm UI responsiva (useTransition)                  โ
โ  โโโบ Sem flash de loading                                  โ
โ                                                              โ
โ  Bundle Size                                                 โ
โ  โโโบ Total: ~200KB (gzipped: ~70KB)                        โ
โ  โโโบ React: ~40KB                                           โ
โ  โโโบ Next.js: ~40KB                                         โ
โ  โโโบ App Code: ~20KB                                        โ
โ  โโโบ Tailwind: ~40KB (purged)                              โ
โ  โโโบ Other: ~20KB                                           โ
โ                                                              โ
โ  Core Web Vitals (Lighthouse)                               โ
โ  โโโบ Performance: 95-100                                    โ
โ  โโโบ Accessibility: 100                                     โ
โ  โโโบ Best Practices: 100                                    โ
โ  โโโบ SEO: 100                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฏ Decisรตes de Arquitetura

### Por que Services?
```
โ Separaรงรฃo de concerns (UI vs lรณgica)
โ Reutilizaรงรฃo de cรณdigo
โ Testabilidade
โ Manutenibilidade
โ Refatoraรงรฃo mais fรกcil
```

### Por que Server Actions?
```
โ Lรณgica no servidor (nรฃo exposta ao cliente)
โ Bundle size menor
โ Type-safe end-to-end
โ Progressive Enhancement
โ Simplicidade (sem API routes)
```

### Por que API Client?
```
โ Retry automรกtico
โ Error handling consistente
โ Timeout configurรกvel
โ Logging centralizado
โ Fรกcil de testar e mockar
```

### Por que TypeScript?
```
โ Type-safety em toda aplicaรงรฃo
โ Autocomplete no IDE
โ Refatoraรงรฃo segura
โ Documentaรงรฃo inline
โ Menos bugs em produรงรฃo
```

---

**รltima atualizaรงรฃo:** 06/10/2025
